<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>LifeOS - Second Brain</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Kalam:wght@400;700&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                        hand: ['Kalam', 'cursive'],
                    },
                    colors: {
                        zinc: {
                            850: '#1f1f22',
                            900: '#18181b',
                            950: '#09090b',
                        },
                        indigo: {
                            500: '#6366f1',
                            600: '#4f46e5',
                            900: '#312e81',
                        }
                    },
                    boxShadow: {
                        'glow': '0 0 15px rgba(79, 70, 229, 0.4)',
                        'glow-sm': '0 0 10px rgba(79, 70, 229, 0.2)',
                    }
                }
            }
        }
    </script>
    
    <style>
        body { 
            -webkit-font-smoothing: antialiased; 
            touch-action: manipulation;
            background-color: #050505;
            color: #e4e4e7;
        }
        
        ::-webkit-scrollbar { width: 4px; height: 4px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #3f3f46; border-radius: 2px; }
        ::-webkit-scrollbar-thumb:hover { background: #52525b; }
        
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        .glass-panel {
            background: rgba(24, 24, 27, 0.6);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        /* Animation Utilities */
        @keyframes pulse-brain {
            0%, 100% { transform: scale(1); opacity: 0.8; }
            50% { transform: scale(1.05); opacity: 1; }
        }
        .animate-brain { animation: pulse-brain 4s infinite ease-in-out; }
    </style>
</head>
<body class="bg-zinc-950 text-zinc-100 min-h-screen overflow-y-auto selection:bg-indigo-500/30 selection:text-indigo-200">
    <div id="root"></div>

    <!-- Application Logic -->
    <script type="module">
        import React, { useState, useEffect, useRef, useCallback } from "https://esm.sh/react@18.2.0";
        import { createRoot } from "https://esm.sh/react-dom@18.2.0/client";
        import { 
            Layout, Home, BookOpen, Target, PenTool, Settings, Search, Bell, Plus, 
            MoreHorizontal, CheckCircle2, Clock, ArrowRight, Brain, Layers, 
            Calendar as CalendarIcon, ChevronRight, Sun, Moon, Filter, Zap, Coffee, 
            Video, MapPin, RefreshCw, MoreVertical, Lightbulb, Sparkles, Trash2, 
            Sprout, Briefcase, DollarSign, Move, Eraser, Palette, MousePointer2, 
            Trophy, Flag, TrendingUp, Award, Crosshair, Star, Bookmark, Book, 
            GraduationCap, Wallet, Building, Users, ExternalLink, Link as LinkIcon, 
            PlayCircle, Film, Music, Gamepad2, MonitorPlay, Headphones, Tv, 
            MessageSquare, AlertCircle, Folder, Minus, CalendarDays, LogOut, Lock, 
            Fingerprint, Delete, KeyRound, ShieldQuestion, RotateCcw, Menu, X, Save, Edit3, Wifi, WifiOff, Database,
            Timer, Play, Pause, Wrench, File, CreditCard, Coins, Heart, Activity, Scissors, Share2, Mail, Archive, Image,
            Cloud, CloudRain, CloudSun, CloudSnow, CloudLightning, Thermometer,
            List, Grid, Columns, Utensils, FileText, Trash, ShieldAlert, Flame, Volume2, ChevronLeft,
            ListTodo, ArrowUpRight, CheckSquare, Flower2, Dumbbell, Github, Bot, Newspaper, QrCode,
            Waves, Wind, Mountain, Footprints, Ban, ShieldCheck, Milestone, User, LogIn, ArrowLeft, Info,
            Eye, EyeOff, Hourglass, AlertTriangle, Check, Cpu, Scroll, Gift, ShoppingBag, Code2, Terminal, Library, Globe, Laptop, Smartphone
        } from "https://esm.sh/lucide-react@0.344.0?deps=react@18.2.0";

        // --- SUPABASE IMPORT ---
        import { createClient } from 'https://esm.sh/@supabase/supabase-js@2.39.3';

        // --- CONFIGURATION ---
        const SUPABASE_URL = "https://zcyzorbmlmcvjsgqlbmp.supabase.co"; 
        const SUPABASE_ANON_KEY = "sb_publishable_6GuAbqCKLI0QOMhPrLHWag_ke5ahM8R";
        
        let supabase = null;
        let isSupabaseConfigured = false;

        if (SUPABASE_URL && SUPABASE_ANON_KEY) {
            try {
                supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
                isSupabaseConfigured = true;
            } catch(e) { 
                console.error("Supabase Init Failed", e);
            }
        }

        // --- LOCAL AUTH SIMULATION (Fallback) ---
        const LocalAuth = {
            login: (email, password) => {
                const users = JSON.parse(localStorage.getItem('lifeos_local_db_users') || '{}');
                const user = users[email.toLowerCase()];
                if (!user) throw new Error("User not found locally. Please create an account.");
                if (user.password !== password) throw new Error("Incorrect password.");
                return { email: user.email, id: user.uid, isLocal: true, displayName: user.displayName || user.email.split('@')[0] };
            },
            signup: (email, password) => {
                const users = JSON.parse(localStorage.getItem('lifeos_local_db_users') || '{}');
                if (users[email.toLowerCase()]) throw new Error("Account already exists. Please sign in.");
                const uid = 'local_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                const displayName = email.split('@')[0];
                users[email.toLowerCase()] = { email, password, uid, displayName };
                localStorage.setItem('lifeos_local_db_users', JSON.stringify(users));
                return { email, id: uid, isLocal: true, displayName };
            }
        };

        // --- ICONS LIBRARY FOR TOOLS ---
        const ICON_LIB = {
            'Globe': Globe, 'Code2': Code2, 'Terminal': Terminal, 'Database': Database,
            'Layout': Layout, 'Palette': Palette, 'PenTool': PenTool, 'Image': Image,
            'Film': Film, 'Music': Music, 'Gamepad': Gamepad2, 'Bot': Bot,
            'Mail': Mail, 'MessageSquare': MessageSquare, 'Github': Github, 'Twitter': Share2,
            'DollarSign': DollarSign, 'CreditCard': CreditCard, 'Book': Book, 'GraduationCap': GraduationCap,
            'Laptop': Laptop, 'Smartphone': Smartphone, 'Monitor': MonitorPlay, 'Cloud': Cloud
        };

        // --- DATA DEFAULTS ---
        const DEFAULT_GOALS_DATA = {
            mission: "Reshape my life by achieving financial stability, building iron discipline, and gaining clear direction for my future.",
            phases: { phase1: [], phase2: [], phase3: [] },
        };

        const DEFAULT_MEALS = [{ day: 'Monday', type: 'Breakfast', text: 'Oats + milk\n1 banana\n1 scoop protein powder' }];
        
        const DEFAULT_TOOLS_CATEGORIES = ['General', 'Development', 'Design', 'Productivity', 'Finance'];
        const DEFAULT_TOOLS = [{ id: 't1', category: 'General', name: 'ChatGPT', url: 'https://chat.openai.com/', icon: 'Bot' }];

        // UPDATED: 4-Day Gym Plan
        const GYM_WORKOUT_PLAN = [
            { id: 'gym1', title: "Day 1: Chest & Triceps", icon: Flame, color: "text-rose-500", warmup: ["5min Treadmill", "Arm Circles"], exercises: [{ name: "Bench Press", sets: "4", reps: "8-10" }, { name: "Incline DB Press", sets: "3", reps: "10-12" }, { name: "Cable Flys", sets: "3", reps: "12-15" }, { name: "Tricep Pushdowns", sets: "4", reps: "12-15" }, { name: "Skullcrushers", sets: "3", reps: "10-12" }], finisher: "Pushup burnout" },
            { id: 'gym2', title: "Day 2: Back & Biceps", icon: Activity, color: "text-blue-500", warmup: ["5min Rower", "Band Pull-aparts"], exercises: [{ name: "Lat Pulldowns", sets: "4", reps: "10-12" }, { name: "Seated Cable Row", sets: "4", reps: "10-12" }, { name: "DB Row", sets: "3", reps: "10/side" }, { name: "Barbell Curls", sets: "3", reps: "10-12" }, { name: "Hammer Curls", sets: "3", reps: "12" }], finisher: "Face Pulls 3x15" },
            { id: 'gym3', title: "Day 3: Legs", icon: Dumbbell, color: "text-emerald-500", warmup: ["Bodyweight Squats", "Leg Swings"], exercises: [{ name: "Barbell Squats", sets: "4", reps: "6-8" }, { name: "Leg Press", sets: "3", reps: "10-12" }, { name: "RDLs", sets: "4", reps: "10" }, { name: "Leg Extensions", sets: "3", reps: "15" }, { name: "Calf Raises", sets: "4", reps: "15-20" }], finisher: "Walking Lunges" },
            { id: 'gym4', title: "Day 4: Shoulders & Abs", icon: Zap, color: "text-purple-500", warmup: ["Dislocations", "Light DB press"], exercises: [{ name: "Overhead Press", sets: "4", reps: "8-10" }, { name: "Lateral Raises", sets: "4", reps: "12-15" }, { name: "Front Plate Raise", sets: "3", reps: "12" }, { name: "Cable Crunches", sets: "4", reps: "15" }, { name: "Leg Raises", sets: "3", reps: "12" }], finisher: "Plank (3 x 1 min)" }
        ];

        const HOME_WORKOUT_PLAN = [
             { id: 'home1', title: "Day 1: Upper Push (DB)", icon: Flame, color: "text-orange-500", warmup: ["Jumping Jacks"], exercises: [{ name: "DB Floor Press", sets: "4", reps: "12" }, { name: "Pushups", sets: "3", reps: "Failure" }, { name: "Shoulder Press", sets: "4", reps: "12" }, { name: "Lateral Raises", sets: "3", reps: "15" }], finisher: "Pushups to failure" },
             { id: 'home2', title: "Day 2: Lower Body (DB)", icon: Activity, color: "text-blue-500", warmup: ["Squats"], exercises: [{ name: "Goblet Squats", sets: "4", reps: "15" }, { name: "DB RDL", sets: "4", reps: "12" }, { name: "Lunges", sets: "3", reps: "12/leg" }], finisher: "Wall Sit" },
             { id: 'home3', title: "Day 3: Full Body", icon: Zap, color: "text-emerald-500", warmup: ["Run 10 mins"], exercises: [{ name: "Burpees", sets: "4", reps: "10" }, { name: "Thrusters", sets: "3", reps: "12" }, { name: "Renegade Rows", sets: "3", reps: "10/side" }], finisher: "Mountain Climbers" },
             { id: 'home4', title: "Day 4: Core & Cardio", icon: Heart, color: "text-rose-500", warmup: ["High Knees"], exercises: [{ name: "Plank", sets: "4", reps: "1 min" }, { name: "Leg Raises", sets: "3", reps: "15" }, { name: "Russian Twists", sets: "3", reps: "20" }], finisher: "Sprints" }
        ];
        
        const FOCUS_SOUNDS = [
            { id: 'rain', label: 'Rain', icon: CloudRain, url: 'https://cdn.pixabay.com/audio/2022/07/04/audio_24e0f0656f.mp3' },
            { id: 'lofi', label: 'Lofi', icon: Music, url: 'https://cdn.pixabay.com/audio/2022/05/27/audio_1808fbf07a.mp3' }
        ];

        const BIBLE_BOOKS_LIB = [
            { category: "Old Testament - Law", books: [{ n: "Genesis", t: "Origins & Family", d: "How family patterns and trauma are passed down." }, { n: "Exodus", t: "Liberation", d: "Breaking free from slavery." }] },
            { category: "Wisdom & Poetry", books: [{ n: "Proverbs", t: "Practical Wisdom", d: "Timeless hacks for money and relationships." }, { n: "Ecclesiastes", t: "Meaning", d: "Finding satisfaction when worldly success feels empty." }] },
            { category: "New Testament", books: [{ n: "Matthew", t: "The Kingdom", d: "Jesus as the true King." }, { n: "Romans", t: "The Gospel", d: "A logical explanation of how God fixes broken humans." }] }
        ];
        
        const BIBLE_CHARACTERS_LIB = [
            { n: "David", t: "Passion & Flaw", d: "Warrior poet. Killed giants, wrote songs, repented deeply." },
            { n: "Paul", t: "Transformation", d: "Terrorist turned missionary. Intellectual powerhouse." }
        ];

        // --- HELPERS ---
        const Card = ({ children, className = "", title, action }) => (
            React.createElement("div", { className: `glass-panel rounded-2xl p-5 flex flex-col transition-all duration-300 hover:border-zinc-700/50 ${className}` },
                (title || action) && (
                    React.createElement("div", { className: "flex justify-between items-center mb-4 border-b border-white/5 pb-2" },
                        title && React.createElement("h3", { className: "text-xs font-bold text-zinc-400 uppercase tracking-widest flex items-center gap-2" }, 
                           React.createElement("span", { className: "w-1.5 h-1.5 rounded-full bg-indigo-500 inline-block" }), title
                        ),
                        action
                    )
                ),
                children
            )
        );

        const NavItem = ({ icon: Icon, label, active, onClick }) => (
            React.createElement("button", { 
                onClick: onClick,
                className: `w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all duration-200 group relative overflow-hidden ${active ? 'text-white' : 'text-zinc-500 hover:text-zinc-300 hover:bg-white/5'}`
            },
                active && React.createElement("div", { className: "absolute inset-0 bg-indigo-600/10 border-l-2 border-indigo-500" }),
                React.createElement(Icon, { size: 18, className: active ? 'text-indigo-400' : 'opacity-70' }),
                React.createElement("span", { className: "font-medium text-sm tracking-wide" }, label)
            )
        );

        const MobileTopBar = ({ handleLogout, user }) => (
            React.createElement("header", { className: "md:hidden fixed top-0 left-0 right-0 bg-zinc-950/80 backdrop-blur-xl border-b border-zinc-800 z-50 px-4 h-14 flex items-center justify-between" },
                React.createElement("div", { className: "flex items-center gap-3" },
                    React.createElement("div", { className: "w-8 h-8 bg-indigo-600 rounded-lg flex items-center justify-center text-white shadow-glow" }, React.createElement(Brain, { size: 18 })),
                    React.createElement("span", { className: "font-bold text-lg tracking-tight text-white" }, "LifeOS")
                ),
                React.createElement("div", { className: "flex items-center gap-2" },
                    user && React.createElement("div", { 
                        className: `p-1.5 rounded-full ${user.isLocal ? 'bg-orange-100 text-orange-600' : 'bg-emerald-100 text-emerald-600'}`,
                        title: user.isLocal ? "Local Mode" : "Cloud Sync Active"
                    }, 
                        user.isLocal ? React.createElement(WifiOff, { size: 14 }) : React.createElement(Wifi, { size: 14 })
                    ),
                    React.createElement("button", { onClick: handleLogout, className: "p-2 text-zinc-400 hover:text-red-400 transition-colors" }, React.createElement(LogOut, { size: 18 }))
                )
            )
        );

        const MobileNavBar = ({ activeTab, setActiveTab, tabConfig }) => {
            const tabs = Object.keys(tabConfig);
            return React.createElement("div", { className: "md:hidden fixed bottom-0 left-0 right-0 bg-zinc-950/90 backdrop-blur-xl border-t border-zinc-800 z-50 px-4 py-2 pb-safe flex h-[4.5rem] shadow-[0_-5px_20px_rgba(0,0,0,0.1)]" },
                React.createElement("div", { className: "flex-1 flex overflow-x-auto no-scrollbar items-center px-2 gap-1" },
                    tabs.map(t => {
                        const isActive = activeTab === t;
                        const config = tabConfig[t];
                        if(!config) return null;
                        return React.createElement("button", {
                            key: t,
                            onClick: () => setActiveTab(t),
                            className: `flex flex-col items-center justify-center min-w-[3.5rem] h-full rounded-xl transition-all shrink-0 ${isActive ? 'text-indigo-400 scale-110' : 'text-zinc-600'}`
                        },
                            React.createElement("div", { className: `p-1.5 rounded-lg mb-0.5 transition-all ${isActive ? 'bg-indigo-500/20' : 'bg-transparent'}` }, React.createElement(config.icon, { size: 20, strokeWidth: isActive ? 2.5 : 2 })),
                            React.createElement("span", { className: "text-[9px] font-medium leading-none" }, config.label.split(' ')[0])
                        );
                    })
                )
            );
        };
        
        const EditableList = ({ items = [], onAdd, onToggle, onDelete, placeholder }) => {
            const [newItem, setNewItem] = useState("");
            return React.createElement("div", { className: "space-y-2" },
                items.map(item => 
                    React.createElement("div", { key: item.id, className: "flex items-start gap-3 w-full group" },
                        React.createElement("button", { onClick: () => onToggle(item.id), className: `mt-0.5 w-5 h-5 rounded border flex items-center justify-center shrink-0 transition-all ${item.completed ? 'bg-indigo-500 border-indigo-500 text-white' : 'border-zinc-700 bg-zinc-900'}` }, 
                            React.createElement(CheckCircle2, { size: 14, className: item.completed ? "opacity-100" : "opacity-0" })
                        ),
                        React.createElement("span", { className: `text-sm leading-snug flex-1 ${item.completed ? 'text-zinc-500 line-through' : 'text-zinc-200'}` }, item.text),
                        React.createElement("button", { onClick: () => onDelete(item.id), className: "text-zinc-600 hover:text-red-400 opacity-0 group-hover:opacity-100 transition-opacity" }, React.createElement(Trash, { size: 14 }))
                    )
                ),
                React.createElement("div", { className: "flex gap-2 mt-2 pt-2 border-t border-zinc-800" },
                    React.createElement("input", { 
                        type: "text", 
                        value: newItem, 
                        onChange: (e) => setNewItem(e.target.value), 
                        onKeyDown: (e) => { if (e.key === 'Enter' && newItem.trim()) { onAdd(newItem); setNewItem(""); } },
                        placeholder: placeholder || "Add new...", 
                        className: "flex-1 bg-transparent text-sm focus:outline-none text-zinc-400 placeholder:text-zinc-600" 
                    }),
                    React.createElement("button", { onClick: () => { if (newItem.trim()) { onAdd(newItem); setNewItem(""); } }, className: "text-indigo-500 hover:text-indigo-400" }, React.createElement(Plus, { size: 16 }))
                )
            );
        };
        
        const TimeWidget = () => {
             const [time, setTime] = useState(new Date());
             useEffect(() => { const t = setInterval(() => setTime(new Date()), 1000); return () => clearInterval(t); }, []);
             return React.createElement("div", { className: "text-right" }, React.createElement("div", { className: "text-3xl font-bold font-mono text-indigo-400" }, time.toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'})), React.createElement("div", { className: "text-xs font-bold uppercase tracking-widest text-zinc-500" }, time.toLocaleDateString()));
        };

        // --- AUTH COMPONENT ---
        const AuthModal = ({ onClose, onLogin, inline = false }) => {
            const [isLogin, setIsLogin] = useState(true);
            const [email, setEmail] = useState("");
            const [password, setPassword] = useState("");
            const [error, setError] = useState(null);
            const [loading, setLoading] = useState(false);

            const handleSubmit = async (e) => {
                e.preventDefault(); setError(null); setLoading(true);
                if (isSupabaseConfigured) {
                    try {
                        const { data, error } = isLogin ? await supabase.auth.signInWithPassword({ email, password }) : await supabase.auth.signUp({ email, password });
                        if (error) throw error;
                        if (data?.user) { onLogin({ email: data.user.email, id: data.user.id, isLocal: false }); if(!inline) onClose(); }
                    } catch(err) { setError(err.message.includes("fetch") ? "Connection failed. Using Local Mode..." : err.message); if(err.message.includes("fetch")) setTimeout(handleLocalAuth, 1000); } finally { setLoading(false); }
                } else { handleLocalAuth(); }
            };

            const handleLocalAuth = () => {
                try {
                    const user = isLogin ? LocalAuth.login(email, password) : LocalAuth.signup(email, password);
                    onLogin(user); if(!inline) onClose();
                } catch(e) { setError(e.message); } finally { setLoading(false); }
            };

            const content = React.createElement("div", { className: inline ? "" : "bg-zinc-900 border border-zinc-800 rounded-2xl p-8 max-w-sm w-full relative" },
                !inline && React.createElement("button", { onClick: onClose, className: "absolute top-4 right-4 text-zinc-400" }, React.createElement(X, { size: 20 })),
                React.createElement("h2", { className: "text-xl font-bold text-white mb-6 text-center" }, isLogin ? "Welcome Back" : "Create Account"),
                React.createElement("form", { onSubmit: handleSubmit, className: "space-y-4" },
                    React.createElement("input", { type: "email", value: email, onChange: e => setEmail(e.target.value), placeholder: "Email", className: "w-full p-3 rounded-xl bg-zinc-950 border border-zinc-800 text-white focus:border-indigo-500 outline-none" }),
                    React.createElement("input", { type: "password", value: password, onChange: e => setPassword(e.target.value), placeholder: "Password", className: "w-full p-3 rounded-xl bg-zinc-950 border border-zinc-800 text-white focus:border-indigo-500 outline-none" }),
                    error && React.createElement("div", { className: "text-red-400 text-xs" }, error),
                    React.createElement("button", { type: "submit", disabled: loading, className: "w-full py-3 bg-indigo-600 text-white rounded-xl font-bold hover:bg-indigo-500" }, loading ? "Processing..." : (isLogin ? "Login" : "Sign Up")),
                    React.createElement("div", { className: "text-center text-xs text-zinc-500 mt-4 cursor-pointer hover:text-white", onClick: () => setIsLogin(!isLogin) }, isLogin ? "Need an account? Sign up" : "Have an account? Login")
                )
            );
            return inline ? content : React.createElement("div", { className: "fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm" }, content);
        };

        // --- LANDING PAGE ---
        const LandingPage = ({ onLoginSuccess, onGuestLogin }) => {
            return React.createElement("div", { className: "min-h-screen flex flex-col md:flex-row bg-zinc-950 text-white font-sans overflow-hidden" },
                React.createElement("div", { className: "fixed inset-0 z-0 pointer-events-none" },
                    React.createElement("div", { className: "absolute top-[-20%] left-[-10%] w-[500px] h-[500px] bg-indigo-600/20 rounded-full blur-[120px]" }),
                    React.createElement("div", { className: "absolute bottom-[-10%] right-[-5%] w-[400px] h-[400px] bg-purple-600/10 rounded-full blur-[100px]" })
                ),
                React.createElement("div", { className: "md:w-1/2 p-8 md:p-16 flex flex-col justify-center relative z-10" },
                    React.createElement("div", { className: "mb-8 flex items-center gap-3" },
                        React.createElement("div", { className: "w-10 h-10 bg-indigo-600 rounded-xl flex items-center justify-center text-white shadow-glow" }, React.createElement(Brain, { size: 20 })),
                        React.createElement("h1", { className: "text-2xl font-bold tracking-tight text-white" }, "LifeOS")
                    ),
                    React.createElement("h2", { className: "text-5xl md:text-7xl font-bold mb-6 leading-tight tracking-tight" }, "Design Your ", React.createElement("span", { className: "text-transparent bg-clip-text bg-gradient-to-r from-indigo-400 to-purple-400" }, "Mind.")),
                    React.createElement("p", { className: "text-zinc-400 text-lg md:text-xl max-w-md leading-relaxed mb-10" }, "A futuristic operating system for your life. Organize habits, tasks, and goals in one unified interface."),
                    React.createElement("div", { className: "grid grid-cols-2 gap-4 max-w-sm" },
                        [{l:"Focus", i:Timer}, {l:"Goals", i:Flag}, {l:"Habits", i:CheckCircle2}, {l:"Health", i:Activity}].map((f, i) => 
                            React.createElement("div", { key: i, className: "flex items-center gap-3 p-3 rounded-xl bg-white/5 border border-white/5" }, 
                                React.createElement(f.i, { className: "text-indigo-400", size: 18 }), 
                                React.createElement("span", { className: "text-sm font-medium text-zinc-300" }, f.l)
                            )
                        )
                    )
                ),
                React.createElement("div", { className: "md:w-1/2 bg-black/40 backdrop-blur-xl border-l border-white/5 flex flex-col justify-center p-8 md:p-16 relative z-20" },
                     React.createElement(AuthModal, { onClose: () => {}, onLogin: onLoginSuccess, inline: true }),
                     React.createElement("div", { className: "mt-6 text-center" },
                        React.createElement("button", { 
                            onClick: () => onGuestLogin({ email: "guest@lifeos.app", displayName: "Guest", uid: "guest-user", isLocal: true }), 
                            className: "text-zinc-500 hover:text-white text-xs font-medium transition-colors flex items-center justify-center gap-2 mx-auto" 
                        }, "Enter as Guest", React.createElement(ArrowRight, { size: 12 }))
                    )
                )
            );
        };

        // --- DASHBOARD VIEW ---
        const DashboardView = ({ onNavigate, tasks = [], deadlines = [], dashboardData = {}, onUpdateDashboard, timerState, toggleTimer, resetTimer }) => {
            const dailyFocus = dashboardData?.focus || "";
            const positiveNote = dashboardData?.positiveNote || "";
            const dailyRules = dashboardData?.dailyRules || { p: false, s: false, w: false, t: false, r: false };
            const pswtrData = [
                { key: 'p', letter: 'P', label: 'Pray', desc: 'Daily prayer' },
                { key: 's', letter: 'S', label: 'Practice Skills', desc: 'Tech practice' },
                { key: 'w', letter: 'W', label: 'Work', desc: 'Income focused' },
                { key: 't', letter: 'T', label: 'Train', desc: 'Gym & Run' },
                { key: 'r', letter: 'R', label: 'Read', desc: 'Page & Notes' }
            ];

            const toggleRule = (key) => {
                const newRules = { ...dailyRules, [key]: !dailyRules[key] };
                onUpdateDashboard({ ...dashboardData, dailyRules: newRules });
            };

            return React.createElement("div", { className: "p-4 space-y-6" },
                React.createElement("div", { className: "flex justify-between items-end mb-4" }, 
                    React.createElement("h2", { className: "text-3xl font-bold tracking-tight text-white" }, "Command Center"), 
                    React.createElement(TimeWidget)
                ),
                React.createElement(Card, { className: "relative overflow-hidden rounded-3xl p-8 border border-indigo-500/30 bg-gradient-to-br from-indigo-900/20 to-black" },
                    React.createElement("div", { className: "relative z-10" },
                        React.createElement("div", { className: "flex items-center gap-2 mb-4 text-indigo-300 text-xs font-bold uppercase tracking-widest" }, 
                            React.createElement(Target, { size: 14 }), "Primary Directive"
                        ),
                        React.createElement("input", { 
                            value: dailyFocus, 
                            onChange: (e) => onUpdateDashboard({ ...dashboardData, focus: e.target.value }),
                            placeholder: "Win the day by...", 
                            className: "w-full bg-transparent border-b-2 border-zinc-700/50 text-3xl md:text-5xl font-bold focus:outline-none py-2 text-white placeholder:text-zinc-700 focus:border-indigo-500 transition-all" 
                        })
                    )
                ),
                React.createElement(Card, { title: "Positive Note to Myself", className: "bg-gradient-to-r from-emerald-900/10 to-teal-900/10 border-emerald-500/20" },
                     React.createElement("textarea", { 
                        value: positiveNote, 
                        onChange: (e) => onUpdateDashboard({ ...dashboardData, positiveNote: e.target.value }),
                        className: "w-full h-24 bg-transparent text-emerald-100/90 text-xl font-hand resize-none focus:outline-none placeholder:text-emerald-500/30 leading-relaxed",
                        placeholder: "Write something kind to yourself..."
                    })
                ),
                React.createElement("div", { className: "grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6" },
                     React.createElement(Card, { title: "Active Tasks" },
                        React.createElement("div", { className: "flex items-center justify-between" },
                             React.createElement("span", { className: "text-4xl font-bold text-white" }, tasks.length),
                             React.createElement(ListTodo, { className: "text-zinc-700", size: 48 })
                        )
                     ),
                     React.createElement(Card, { title: "Next Deadline" },
                        deadlines[0] ? React.createElement("div", null, 
                            React.createElement("p", { className: "font-bold text-white truncate" }, deadlines[0].title),
                            React.createElement("p", { className: "text-sm text-zinc-400 mt-1" }, new Date(deadlines[0].date).toLocaleDateString())
                        ) : React.createElement("p", { className: "text-zinc-500" }, "All clear.")
                     ),
                     React.createElement(Card, { title: "Daily Rules (PSWTR)", className: "md:col-span-2" },
                        React.createElement("div", { className: "grid grid-cols-5 gap-2" },
                            pswtrData.map(item => 
                                React.createElement("button", { 
                                    key: item.key, 
                                    onClick: () => toggleRule(item.key),
                                    className: `flex flex-col items-center justify-center p-2 rounded-lg transition-all ${dailyRules[item.key] ? 'bg-indigo-600/20 border border-indigo-500/50' : 'bg-zinc-800/50 border border-transparent hover:bg-zinc-800'}`
                                },
                                    React.createElement("span", { className: `text-lg font-bold ${dailyRules[item.key] ? 'text-indigo-400' : 'text-zinc-500'}` }, item.letter),
                                    React.createElement("span", { className: "text-[8px] uppercase tracking-wider text-zinc-500" }, item.label.split(' ')[0])
                                )
                            )
                        )
                     )
                )
            );
        };

        // --- TASKS VIEW ---
        const TasksView = ({ tasks, onAddTask, onDeleteTask, onUpdateTask }) => {
            const TaskBox = ({ title, category, colorClass, icon: Icon }) => {
                const [input, setInput] = useState("");
                const categoryTasks = tasks.filter(t => t.category === category || (category === 'normal' && !['hardest', 'easiest'].includes(t.category)));
                const isFull = categoryTasks.length >= 1;

                return React.createElement("div", { className: "flex flex-col h-full bg-zinc-900/30 border border-zinc-800 rounded-2xl overflow-hidden shadow-lg" },
                    React.createElement("div", { className: `p-4 border-b border-zinc-800 ${colorClass} bg-opacity-10 backdrop-blur-sm flex justify-between items-center` },
                        React.createElement("div", { className: "flex items-center gap-2" },
                            Icon && React.createElement(Icon, { size: 16, className: "opacity-80" }),
                            React.createElement("h3", { className: "font-bold text-sm uppercase tracking-wider text-white" }, title)
                        ),
                        React.createElement("span", { className: "text-xs font-mono bg-black/20 px-2 py-1 rounded text-white/70" }, `${categoryTasks.filter(t => t.completed).length}/${categoryTasks.length}`)
                    ),
                    React.createElement("div", { className: "flex-1 p-3 space-y-2 overflow-y-auto min-h-[200px]" },
                        categoryTasks.length === 0 ? React.createElement("div", { className: "h-full flex flex-col items-center justify-center text-zinc-700 opacity-50" }, React.createElement("span", { className: "text-xs italic" }, "Empty")) :
                        categoryTasks.map(t => React.createElement("div", { key: t.id, className: "p-3 rounded-xl bg-zinc-900/80 border border-zinc-800 flex gap-3 items-start group hover:border-zinc-600 transition-all hover:shadow-md" },
                             React.createElement("button", { onClick: () => onUpdateTask(t.id, { completed: !t.completed }), className: `mt-0.5 w-5 h-5 rounded-md border flex items-center justify-center shrink-0 transition-all ${t.completed ? 'bg-indigo-600 border-indigo-600 text-white shadow-glow-sm' : 'border-zinc-600 hover:border-zinc-400 bg-black/40'}` }, t.completed && React.createElement(Check, { size: 14 })),
                             React.createElement("span", { className: `text-sm flex-1 leading-snug break-words ${t.completed ? "text-zinc-500 line-through" : "text-zinc-200"}` }, t.text),
                             React.createElement("button", { onClick: () => onDeleteTask(t.id), className: "text-zinc-600 hover:text-red-400 opacity-0 group-hover:opacity-100 transition-opacity" }, React.createElement(Trash, { size: 14 }))
                        ))
                    ),
                    React.createElement("div", { className: "p-3 border-t border-zinc-800 bg-zinc-900/50" },
                        isFull ? 
                        React.createElement("div", { className: "w-full py-3 text-center opacity-50" }, React.createElement("span", { className: "text-xs font-medium text-zinc-500" }, "Daily limit reached")) :
                        React.createElement("div", { className: "relative group/input" },
                            React.createElement("input", { 
                                value: input, 
                                onChange: e => setInput(e.target.value), 
                                onKeyDown: e => { if(e.key === 'Enter' && input.trim()) { onAddTask({ text: input, category, completed: false }); setInput(""); }},
                                className: "w-full p-3 pr-10 rounded-xl bg-black/50 border border-zinc-800 text-sm text-white focus:border-indigo-500 focus:outline-none placeholder:text-zinc-600 transition-all focus:bg-black", 
                                placeholder: "Add task..." 
                            }),
                            React.createElement("button", { 
                                onClick: () => { if(input.trim()) { onAddTask({ text: input, category, completed: false }); setInput(""); }},
                                className: "absolute right-2 top-1/2 -translate-y-1/2 p-1.5 bg-zinc-800 text-zinc-400 hover:text-white rounded-lg transition-colors group-focus-within/input:bg-indigo-600 group-focus-within/input:text-white"
                            }, React.createElement(Plus, { size: 16 }))
                        )
                    )
                );
            };

            return React.createElement("div", { className: "p-4 pb-24 space-y-6" }, 
                React.createElement("div", { className: "flex justify-between items-end" },
                    React.createElement("div", null,
                        React.createElement("h2", { className: "text-3xl font-bold text-white" }, "Daily Tasks"),
                        React.createElement("p", { className: "text-zinc-400 text-sm mt-1" }, "Prioritize and execute.")
                    ),
                    React.createElement("span", { className: "text-zinc-500 text-xs font-mono uppercase tracking-widest hidden md:block" }, new Date().toLocaleDateString(undefined, { weekday: 'long', month: 'long', day: 'numeric' }))
                ),
                React.createElement("div", { className: "grid grid-cols-1 lg:grid-cols-3 gap-6 h-[calc(100vh-250px)] min-h-[500px]" },
                    React.createElement(TaskBox, { title: "Hardest Task", category: "hardest", colorClass: "bg-rose-500/20 text-rose-300", icon: Flame }),
                    React.createElement(TaskBox, { title: "Normal Tasks", category: "normal", colorClass: "bg-indigo-500/20 text-indigo-300", icon: Layers }),
                    React.createElement(TaskBox, { title: "Easiest Task", category: "easiest", colorClass: "bg-emerald-500/20 text-emerald-300", icon: Coffee })
                )
            );
        };

        // --- FOOD VIEW ---
        const FoodView = ({ meals, onUpdateMeal }) => {
             const days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];
             const mealTypes = ['Breakfast', 'Lunch', 'Dinner', 'Snack'];
             const getMeal = (d, t) => { const m = meals.find(item => item.day === d && item.type === t); return m ? m.text : ""; };

             return React.createElement("div", { className: "p-4 pb-24" },
                React.createElement("div", { className: "flex justify-between items-center mb-6" },
                    React.createElement("h2", { className: "text-3xl font-bold text-white" }, "Weekly Nutrition"),
                    React.createElement("div", { className: "text-zinc-400 text-sm" }, "Plan your fuel.")
                ),
                React.createElement("div", { className: "space-y-8" },
                    days.map(day => 
                        React.createElement("div", { key: day, className: "bg-zinc-900/30 border border-zinc-800 rounded-2xl overflow-hidden" },
                            React.createElement("div", { className: "bg-zinc-900/80 p-3 border-b border-zinc-800 flex items-center gap-2" },
                                React.createElement(CalendarDays, { size: 16, className: "text-indigo-500" }),
                                React.createElement("h3", { className: "font-bold text-white" }, day)
                            ),
                            React.createElement("div", { className: "grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 divide-y md:divide-y-0 md:divide-x divide-zinc-800/50" },
                                mealTypes.map(type => 
                                    React.createElement("div", { key: type, className: "p-4 hover:bg-zinc-900/50 transition-colors" },
                                        React.createElement("div", { className: "text-[10px] font-bold text-zinc-500 uppercase tracking-wider mb-2" }, type),
                                        React.createElement("textarea", { 
                                            value: getMeal(day, type), 
                                            onChange: (e) => onUpdateMeal(day, type, e.target.value), 
                                            className: "w-full bg-transparent text-zinc-200 text-sm resize-none focus:outline-none placeholder:text-zinc-700 min-h-[60px]",
                                            placeholder: "-", rows: 3
                                        })
                                    )
                                )
                            )
                        )
                    )
                )
             );
        };

        // --- FITNESS VIEW ---
        const FitnessView = () => {
             const [planType, setPlanType] = useState('gym');
             const currentPlan = planType === 'gym' ? GYM_WORKOUT_PLAN : HOME_WORKOUT_PLAN;
             
             return React.createElement("div", { className: "p-4 pb-24" },
                 React.createElement("div", { className: "flex justify-between items-center mb-6" }, 
                     React.createElement("h2", { className: "text-3xl font-bold text-white" }, "Fitness"),
                     React.createElement("div", { className: "flex gap-2 p-1 bg-zinc-900 rounded-lg border border-zinc-800" }, 
                         React.createElement("button", { onClick: () => setPlanType('gym'), className: `px-4 py-1.5 text-sm rounded-md transition-all ${planType === 'gym' ? 'bg-indigo-600 text-white' : 'text-zinc-500 hover:text-zinc-300'}` }, "Gym"),
                         React.createElement("button", { onClick: () => setPlanType('home'), className: `px-4 py-1.5 text-sm rounded-md transition-all ${planType === 'home' ? 'bg-indigo-600 text-white' : 'text-zinc-500 hover:text-zinc-300'}` }, "Home")
                     )
                 ),
                 React.createElement("div", { className: "grid grid-cols-1 md:grid-cols-2 gap-4" },
                     currentPlan.map(s => React.createElement("div", { key: s.id, className: "p-6 border border-zinc-800 rounded-2xl bg-zinc-900/30" }, 
                         React.createElement("div", { className: "flex items-center gap-3 mb-4" },
                            React.createElement(s.icon, { className: s.color, size: 24 }),
                            React.createElement("h3", { className: "font-bold text-lg text-white" }, s.title)
                         ),
                         React.createElement("ul", { className: "space-y-2 mb-4" }, s.exercises.map((e, i) => React.createElement("li", { key: i, className: "text-sm text-zinc-400 flex justify-between border-b border-zinc-800/50 pb-1" }, React.createElement("span", null, e.name), React.createElement("span", { className: "font-mono text-zinc-600" }, `${e.sets}x${e.reps}`)))),
                         React.createElement("div", { className: "text-xs text-red-400 font-bold uppercase tracking-wider" }, `Finisher: ${s.finisher}`)
                     ))
                 )
             );
        };

        // --- BRAIN DUMP VIEW ---
        const BrainDumpView = ({ dumps, onAddDump, onDeleteDump }) => {
            const [input, setInput] = useState("");
            return React.createElement("div", { className: "p-4" },
                React.createElement("h2", { className: "text-3xl font-bold text-white mb-6" }, "Brain Dump"),
                React.createElement("div", { className: "flex gap-2 mb-8" },
                    React.createElement("input", { value: input, onChange: e => setInput(e.target.value), className: "flex-1 p-3 bg-zinc-900 border border-zinc-800 rounded-xl text-white", placeholder: "What's on your mind?" }),
                    React.createElement("button", { onClick: () => { if(input) { onAddDump(input); setInput(""); } }, className: "p-3 bg-indigo-600 text-white rounded-xl" }, React.createElement(Plus, { size: 20 }))
                ),
                React.createElement("div", { className: "grid grid-cols-2 md:grid-cols-3 gap-4" },
                    dumps.map(d => React.createElement("div", { key: d.id, className: "p-4 bg-zinc-900/50 border border-zinc-800 rounded-xl relative group" },
                        React.createElement("p", { className: "text-zinc-300 text-sm" }, d.text),
                        React.createElement("button", { onClick: () => onDeleteDump(d.id), className: "absolute top-2 right-2 text-zinc-600 hover:text-red-500 opacity-0 group-hover:opacity-100" }, React.createElement(Trash, { size: 14 }))
                    ))
                )
            );
        };
        
        // --- DEADLINES VIEW ---
        const DeadlinesView = ({ deadlines = [], onAddDeadline, onDeleteDeadline }) => {
            const [newTitle, setNewTitle] = useState("");
            const [newDate, setNewDate] = useState("");
            return React.createElement("div", { className: "p-4" },
                React.createElement("h2", { className: "text-3xl font-bold text-white mb-6" }, "Deadlines"),
                React.createElement("div", { className: "flex gap-3 mb-6 bg-zinc-900/50 p-4 rounded-xl border border-zinc-800" },
                    React.createElement("input", { value: newTitle, onChange: e => setNewTitle(e.target.value), placeholder: "Deadline Title", className: "flex-1 bg-transparent text-white focus:outline-none" }),
                    React.createElement("input", { type: "date", value: newDate, onChange: e => setNewDate(e.target.value), className: "bg-transparent text-zinc-400 focus:text-white focus:outline-none" }),
                    React.createElement("button", { onClick: () => { if(newTitle && newDate) { onAddDeadline({ title: newTitle, date: newDate }); setNewTitle(""); setNewDate(""); } }, className: "text-indigo-500 hover:text-indigo-400" }, "Add")
                ),
                React.createElement("div", { className: "space-y-3" },
                    deadlines.sort((a,b) => new Date(a.date) - new Date(b.date)).map(d => 
                        React.createElement("div", { key: d.id, className: "flex justify-between items-center p-4 bg-zinc-900/30 border border-zinc-800 rounded-xl" },
                            React.createElement("div", null,
                                React.createElement("h4", { className: "font-bold text-white" }, d.title),
                                React.createElement("p", { className: "text-xs text-zinc-500" }, new Date(d.date).toLocaleDateString())
                            ),
                            React.createElement("button", { onClick: () => onDeleteDeadline(d.id), className: "text-zinc-600 hover:text-red-500" }, React.createElement(Trash, { size: 16 }))
                        )
                    )
                )
            );
        };

        // --- GOALS VIEW ---
        const Goals2026View = ({ goalsData, onUpdateGoals }) => {
            const updateSection = (path, newData) => {
                const newGoals = { ...goalsData };
                if (path.includes('.')) {
                    const [parent, child] = path.split('.');
                    if (!newGoals[parent]) newGoals[parent] = {};
                    newGoals[parent][child] = newData;
                } else newGoals[path] = newData;
                onUpdateGoals(newGoals);
            };
            const addItem = (path, text) => {
                const [parent, child] = path.split('.');
                const list = (goalsData[parent] && goalsData[parent][child]) ? goalsData[parent][child] : [];
                updateSection(path, [...list, { id: Date.now().toString(), text, completed: false }]);
            };
            const toggleItem = (path, id) => {
                 const [parent, child] = path.split('.');
                 const list = goalsData[parent][child];
                 updateSection(path, list.map(i => i.id === id ? { ...i, completed: !i.completed } : i));
            };
            const deleteItem = (path, id) => {
                 const [parent, child] = path.split('.');
                 const list = goalsData[parent][child];
                 updateSection(path, list.filter(i => i.id !== id));
            };

            return React.createElement("div", { className: "p-4 space-y-8 pb-24" },
                React.createElement(Card, { className: "bg-indigo-900/20 border-indigo-500/30" },
                    React.createElement("h4", { className: "text-lg font-bold text-indigo-300 mb-2" }, "Primary Mission"),
                    React.createElement("p", { className: "text-xl font-bold text-white leading-relaxed" }, goalsData.mission)
                ),
                React.createElement("div", { className: "grid gap-6 md:grid-cols-3" },
                    React.createElement(Card, { title: "Phase 1: Stabilise" }, React.createElement(EditableList, { items: goalsData.phases?.phase1 || [], onAdd: t=>addItem('phases.phase1', t), onToggle: id=>toggleItem('phases.phase1', id), onDelete: id=>deleteItem('phases.phase1', id) })),
                    React.createElement(Card, { title: "Phase 2: Discipline" }, React.createElement(EditableList, { items: goalsData.phases?.phase2 || [], onAdd: t=>addItem('phases.phase2', t), onToggle: id=>toggleItem('phases.phase2', id), onDelete: id=>deleteItem('phases.phase2', id) })),
                    React.createElement(Card, { title: "Phase 3: Direction" }, React.createElement(EditableList, { items: goalsData.phases?.phase3 || [], onAdd: t=>addItem('phases.phase3', t), onToggle: id=>toggleItem('phases.phase3', id), onDelete: id=>deleteItem('phases.phase3', id) }))
                )
            );
        };

        // --- FOCUS VIEW (Modernized) ---
        const FocusView = ({ timerState, toggleTimer, resetTimer, activeSound, isPlayingSound, toggleSound }) => {
            const format = (s) => `${Math.floor(s / 60).toString().padStart(2,'0')}:${(s % 60).toString().padStart(2,'0')}`;
            const progress = ((timerState.initialTime - timerState.timeLeft) / timerState.initialTime) * 100;
            const radius = 140; 
            const circumference = 2 * Math.PI * radius;
            const strokeDashoffset = circumference - (progress / 100) * circumference;

            return React.createElement("div", { className: "h-full flex flex-col items-center justify-center relative overflow-hidden" },
                React.createElement("div", { className: `absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[600px] h-[600px] bg-indigo-500/10 rounded-full blur-[120px] transition-all duration-1000 ${timerState.isActive ? 'scale-110 opacity-100' : 'scale-90 opacity-40'}` }),
                React.createElement("div", { className: "relative z-10 flex flex-col items-center w-full max-w-2xl" },
                    React.createElement("div", { className: "flex gap-1 mb-10 bg-black/40 p-1.5 rounded-full border border-white/5 backdrop-blur-md shadow-xl" },
                        [{ m: 25, l: "Focus" }, { m: 5, l: "Short Break" }, { m: 15, l: "Long Break" }, { m: 60, l: "Deep Work" }].map(p => 
                            React.createElement("button", { key: p.m, onClick: () => resetTimer(p.m * 60), className: `px-5 py-2 rounded-full text-xs font-bold transition-all duration-300 ${timerState.initialTime === p.m * 60 ? 'bg-white text-black shadow-[0_0_15px_rgba(255,255,255,0.3)]' : 'text-zinc-400 hover:text-white hover:bg-white/10'}` }, p.l)
                        )
                    ),
                    React.createElement("div", { className: "relative mb-12 group" },
                        React.createElement("svg", { className: "w-[340px] h-[340px] transform -rotate-90 drop-shadow-2xl" },
                            React.createElement("circle", { cx: "170", cy: "170", r: radius, stroke: "#18181b", strokeWidth: "3", fill: "transparent" }),
                            React.createElement("circle", { cx: "170", cy: "170", r: radius, stroke: "currentColor", strokeWidth: "3", fill: "transparent", strokeDasharray: circumference, strokeDashoffset: strokeDashoffset, className: `transition-all duration-1000 ease-linear ${timerState.isActive ? 'text-indigo-500 shadow-[0_0_20px_currentColor]' : 'text-zinc-600'}`, strokeLinecap: "round" })
                        ),
                        React.createElement("div", { className: "absolute inset-0 flex flex-col items-center justify-center" },
                            React.createElement("div", { className: "text-7xl md:text-8xl font-mono font-bold tracking-tighter text-white tabular-nums drop-shadow-lg" }, format(timerState.timeLeft)),
                            React.createElement("div", { className: `mt-6 flex gap-4 transition-all duration-300 ${timerState.isActive ? 'opacity-0 group-hover:opacity-100 translate-y-2 group-hover:translate-y-0' : 'opacity-100'}` },
                                React.createElement("button", { onClick: toggleTimer, className: "w-14 h-14 rounded-full flex items-center justify-center bg-white text-black hover:scale-110 transition-transform shadow-[0_0_20px_rgba(255,255,255,0.2)]" }, timerState.isActive ? React.createElement(Pause, { size: 24, fill: "currentColor" }) : React.createElement(Play, { size: 24, fill: "currentColor", className: "ml-1" })),
                                React.createElement("button", { onClick: () => resetTimer(), className: "w-14 h-14 rounded-full flex items-center justify-center bg-zinc-900 text-zinc-400 border border-zinc-800 hover:border-zinc-600 hover:text-white transition-all hover:scale-105" }, React.createElement(RotateCcw, { size: 20 }))
                            )
                        )
                    ),
                    React.createElement("div", { className: "bg-black/30 backdrop-blur-xl border border-white/5 rounded-2xl p-2 px-6 flex items-center gap-8 shadow-2xl" },
                        React.createElement("div", { className: "text-[10px] font-bold text-zinc-600 uppercase tracking-widest mr-2" }, "Soundscape"),
                        FOCUS_SOUNDS.map(s => {
                             const isActive = activeSound === s.id && isPlayingSound;
                             return React.createElement("button", { key: s.id, onClick: () => toggleSound(s), className: `flex items-center gap-3 py-2 px-3 rounded-lg transition-all ${isActive ? 'text-indigo-400 bg-indigo-500/10' : 'text-zinc-500 hover:text-zinc-300'}` }, React.createElement(s.icon, { size: 20, className: isActive ? "animate-pulse" : "" }), React.createElement("span", { className: "text-xs font-bold" }, s.label), isActive && React.createElement("div", { className: "w-1.5 h-1.5 rounded-full bg-indigo-500 ml-1 shadow-[0_0_5px_currentColor]" }));
                        })
                    )
                )
            );
        };

        // --- SPIRITUALITY VIEW ---
        const SpiritualityView = ({ notes, onAddNote, onDeleteNote }) => {
            const [activeSubTab, setActiveSubTab] = useState("books");
            const [input, setInput] = useState("");

            return React.createElement("div", { className: "p-4 pb-24 h-full flex flex-col" },
                React.createElement("div", { className: "flex flex-col md:flex-row md:items-center justify-between gap-4 mb-6" },
                    React.createElement("h2", { className: "text-3xl font-bold text-white" }, "Spirituality"),
                    React.createElement("div", { className: "flex p-1 bg-zinc-900 rounded-lg border border-zinc-800 self-start md:self-auto" },
                        [{ id: "books", label: "Books", icon: Book }, { id: "people", label: "People", icon: Users }, { id: "notes", label: "Notes", icon: Edit3 }].map(tab => 
                            React.createElement("button", {
                                key: tab.id, onClick: () => setActiveSubTab(tab.id),
                                className: `px-4 py-2 rounded-md text-sm font-bold flex items-center gap-2 transition-all ${activeSubTab === tab.id ? 'bg-indigo-600 text-white shadow-sm' : 'text-zinc-400 hover:text-white hover:bg-zinc-800'}`
                            }, React.createElement(tab.icon, { size: 14 }), tab.label)
                        )
                    )
                ),
                React.createElement("div", { className: "flex-1 overflow-y-auto custom-scrollbar pr-2" },
                    activeSubTab === "books" && React.createElement("div", { className: "space-y-8" }, BIBLE_BOOKS_LIB.map((section, idx) => React.createElement("div", { key: idx, className: "space-y-3" }, React.createElement("h3", { className: "text-indigo-400 font-bold text-xs uppercase tracking-widest sticky top-0 bg-zinc-950 py-2 z-10 border-b border-zinc-900" }, section.category), React.createElement("div", { className: "grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-3" }, section.books.map((book, bIdx) => React.createElement("div", { key: bIdx, className: "p-4 bg-zinc-900/40 border border-zinc-800 rounded-xl" }, React.createElement("h4", { className: "font-bold text-white" }, book.n), React.createElement("span", { className: "text-[10px] font-bold bg-zinc-800 text-zinc-400 px-2 py-1 rounded-md" }, book.t), React.createElement("p", { className: "text-sm text-zinc-400 mt-2" }, book.d))))))),
                    activeSubTab === "people" && React.createElement("div", { className: "grid grid-cols-1 md:grid-cols-3 gap-4" }, BIBLE_CHARACTERS_LIB.map((p, i) => React.createElement("div", { key: i, className: "p-4 border border-zinc-800 rounded-xl bg-zinc-900/30" }, React.createElement("h4", { className: "font-bold text-white" }, p.n), React.createElement("p", { className: "text-zinc-500 text-xs mt-1" }, p.d)))),
                    activeSubTab === "notes" && React.createElement("div", { className: "space-y-6" },
                        React.createElement("div", { className: "bg-zinc-900 p-4 rounded-2xl border border-zinc-800" },
                            React.createElement("textarea", { value: input, onChange: e => setInput(e.target.value), className: "w-full bg-transparent text-white resize-none h-24 focus:outline-none placeholder:text-zinc-600", placeholder: "Prayer requests, insights..." }),
                            React.createElement("button", { onClick: () => { if(input.trim()) { onAddNote(input); setInput(""); }}, className: "px-4 py-2 bg-indigo-600 text-white rounded-lg text-sm font-bold mt-2" }, "Save Entry")
                        ),
                        React.createElement("div", { className: "space-y-3" }, notes.map(n => React.createElement("div", { key: n.id, className: "p-5 border border-zinc-800 rounded-2xl bg-zinc-900/30 flex justify-between" }, React.createElement("p", { className: "text-zinc-300 text-sm whitespace-pre-wrap" }, n.text), React.createElement("button", { onClick: () => onDeleteNote(n.id), className: "text-zinc-600 hover:text-red-500" }, React.createElement(Trash, { size: 14 })))))
                    )
                )
            );
        };

        // 1. WISHLIST VIEW (Updated Design)
        const WishlistView = ({ wishlist, onAddItem, onDeleteItem }) => {
            const [newItem, setNewItem] = useState({ name: "", price: "", priority: "Medium" });
            const [showAdd, setShowAdd] = useState(false);
            const priorityColors = { High: "text-rose-400 bg-rose-400/10 border-rose-400/20", Medium: "text-yellow-400 bg-yellow-400/10 border-yellow-400/20", Low: "text-emerald-400 bg-emerald-400/10 border-emerald-400/20" };
            const handleAdd = () => { if(newItem.name) { onAddItem(newItem); setNewItem({ name: "", price: "", priority: "Medium" }); setShowAdd(false); } };
            const totalValue = wishlist.reduce((acc, item) => acc + (parseFloat(item.price) || 0), 0);
            
            return React.createElement("div", { className: "p-4 pb-24 h-full flex flex-col" },
                React.createElement("div", { className: "flex justify-between items-center mb-6" }, 
                    React.createElement("div", null, 
                        React.createElement("h2", { className: "text-3xl font-bold text-white" }, "Wishlist"), 
                        React.createElement("p", { className: "text-zinc-400 text-sm" }, `Total Value: $${totalValue.toLocaleString()}`)
                    ), 
                    React.createElement("button", { onClick: () => setShowAdd(!showAdd), className: "p-2 bg-indigo-600 rounded-lg text-white hover:bg-indigo-500 transition-colors" }, React.createElement(Plus, { size: 20 }))
                ),
                showAdd && React.createElement(Card, { className: "mb-6 animate-in fade-in slide-in-from-top-4" }, 
                    React.createElement("div", { className: "grid grid-cols-1 gap-4" }, 
                        React.createElement("input", { value: newItem.name, onChange: e => setNewItem({...newItem, name: e.target.value}), placeholder: "Item Name", className: "p-3 bg-black/50 border border-zinc-700 rounded-xl text-white focus:outline-none focus:border-indigo-500" }), 
                        React.createElement("div", { className: "flex gap-4" },
                            React.createElement("input", { value: newItem.price, type: "number", onChange: e => setNewItem({...newItem, price: e.target.value}), placeholder: "Price", className: "flex-1 p-3 bg-black/50 border border-zinc-700 rounded-xl text-white focus:outline-none focus:border-indigo-500" }), 
                            React.createElement("select", { value: newItem.priority, onChange: e => setNewItem({...newItem, priority: e.target.value}), className: "flex-1 p-3 bg-black/50 border border-zinc-700 rounded-xl text-white focus:outline-none focus:border-indigo-500" }, ['High', 'Medium', 'Low'].map(p => React.createElement("option", { key: p, value: p }, p)))
                        )
                    ), 
                    React.createElement("button", { onClick: handleAdd, className: "mt-4 w-full py-3 bg-indigo-600 text-white rounded-xl font-bold hover:bg-indigo-500 transition-colors" }, "Add Item")
                ),
                React.createElement("div", { className: "grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 overflow-y-auto" }, 
                    wishlist.length === 0 ? React.createElement("div", { className: "col-span-full text-center text-zinc-600 py-10" }, "No wishes yet.") : 
                    wishlist.map(item => React.createElement("div", { key: item.id, className: "group relative bg-zinc-900/40 border border-zinc-800 rounded-xl p-5 hover:border-indigo-500/30 transition-all hover:bg-zinc-900" }, 
                        React.createElement("div", { className: "flex justify-between items-start mb-3" }, 
                            React.createElement("span", { className: `text-[10px] font-bold uppercase px-2 py-1 rounded-md border ${priorityColors[item.priority]}` }, item.priority), 
                            React.createElement("button", { onClick: () => onDeleteItem(item.id), className: "text-zinc-600 hover:text-red-500 opacity-0 group-hover:opacity-100 transition-opacity p-1" }, React.createElement(Trash2, { size: 16 }))
                        ), 
                        React.createElement("h3", { className: "font-bold text-xl text-white mb-1" }, item.name), 
                        React.createElement("div", { className: "text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-emerald-400 to-teal-500 mt-2" }, `$${item.price}`)
                    ))
                )
            );
        };

        // 2. LIBRARY VIEW
        const LibraryView = ({ books, onAddBook, onDeleteBook, onUpdateBook }) => {
            const [statusFilter, setStatusFilter] = useState("All");
            const [showAdd, setShowAdd] = useState(false);
            const [newBook, setNewBook] = useState({ title: "", author: "", status: "To Read", rating: 0 });
            const handleAdd = () => { if(newBook.title) { onAddBook(newBook); setNewBook({ title: "", author: "", status: "To Read", rating: 0 }); setShowAdd(false); } };
            const filteredBooks = statusFilter === "All" ? books : books.filter(b => b.status === statusFilter);
            return React.createElement("div", { className: "p-4 pb-24 h-full flex flex-col" },
                React.createElement("div", { className: "flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-6" }, React.createElement("div", null, React.createElement("h2", { className: "text-3xl font-bold text-white" }, "Library"), React.createElement("p", { className: "text-zinc-400 text-sm" }, "Track your reading journey.")), React.createElement("button", { onClick: () => setShowAdd(!showAdd), className: "px-4 py-2 bg-indigo-600 rounded-lg text-white font-bold text-sm" }, "+ Add Book")),
                React.createElement("div", { className: "flex gap-2 mb-6 overflow-x-auto no-scrollbar" }, ['All', 'Reading', 'To Read', 'Finished'].map(s => React.createElement("button", { key: s, onClick: () => setStatusFilter(s), className: `px-3 py-1.5 rounded-full text-xs font-bold whitespace-nowrap transition-all ${statusFilter === s ? 'bg-white text-black' : 'bg-zinc-900 text-zinc-400 border border-zinc-800'}` }, s))),
                showAdd && React.createElement(Card, { className: "mb-6" }, React.createElement("div", { className: "grid grid-cols-1 md:grid-cols-3 gap-4" }, React.createElement("input", { value: newBook.title, onChange: e => setNewBook({...newBook, title: e.target.value}), placeholder: "Book Title", className: "p-2 bg-black/50 border border-zinc-700 rounded-lg text-white focus:outline-none" }), React.createElement("input", { value: newBook.author, onChange: e => setNewBook({...newBook, author: e.target.value}), placeholder: "Author", className: "p-2 bg-black/50 border border-zinc-700 rounded-lg text-white focus:outline-none" }), React.createElement("select", { value: newBook.status, onChange: e => setNewBook({...newBook, status: e.target.value}), className: "p-2 bg-black/50 border border-zinc-700 rounded-lg text-white focus:outline-none" }, ['Reading', 'To Read', 'Finished'].map(s => React.createElement("option", { key: s, value: s }, s)))), React.createElement("button", { onClick: handleAdd, className: "mt-4 w-full py-2 bg-zinc-800 text-white rounded-lg font-bold hover:bg-zinc-700" }, "Save Book")),
                React.createElement("div", { className: "grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-6" }, filteredBooks.map(book => React.createElement("div", { key: book.id, className: "group relative aspect-[2/3] perspective-1000" }, React.createElement("div", { className: "absolute inset-0 bg-gradient-to-br from-zinc-800 to-zinc-900 border border-zinc-700 rounded-r-md rounded-l-sm shadow-xl flex flex-col p-4 justify-between transform transition-transform group-hover:-translate-y-2" }, React.createElement("div", { className: "absolute left-1 top-0 bottom-0 w-1 bg-zinc-700/50" }), React.createElement("div", null, React.createElement("h4", { className: "text-white font-bold leading-tight line-clamp-3" }, book.title), React.createElement("p", { className: "text-zinc-400 text-xs mt-1" }, book.author)), React.createElement("div", null, React.createElement("span", { className: `text-[10px] uppercase font-bold px-1.5 py-0.5 rounded ${book.status === 'Reading' ? 'bg-indigo-500/20 text-indigo-300' : 'bg-zinc-700/30 text-zinc-500'}` }, book.status))), React.createElement("button", { onClick: () => onDeleteBook(book.id), className: "absolute -top-2 -right-2 bg-red-500 text-white p-1 rounded-full shadow-lg opacity-0 group-hover:opacity-100 transition-opacity z-10" }, React.createElement(X, { size: 12 })))))
            );
        };

        // 3. UPDATED TOOLS VIEW (Improved Structure)
        const ToolsView = ({ tools, categories, onAddTool, onAddCategory }) => {
            const [selectedCategory, setSelectedCategory] = useState("All");
            const [showAddModal, setShowAddModal] = useState(false);
            const [newTool, setNewTool] = useState({ name: "", url: "", category: "General", icon: "Link" });
            const [isCustomCategory, setIsCustomCategory] = useState(false);
            const [customCategoryName, setCustomCategoryName] = useState("");
            
            const handleAdd = () => { if(newTool.name && newTool.url) { const finalCategory = isCustomCategory ? customCategoryName : newTool.category; if (isCustomCategory && customCategoryName) onAddCategory(customCategoryName); onAddTool({ ...newTool, category: finalCategory }); setShowAddModal(false); setNewTool({ name: "", url: "", category: "General", icon: "Link" }); setCustomCategoryName(""); setIsCustomCategory(false); } };

            // Group tools by category for "All" view
            const renderTools = () => {
                if (selectedCategory !== "All") {
                    const filtered = tools.filter(t => t.category === selectedCategory);
                    return React.createElement("div", { className: "grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-4" },
                        filtered.map(tool => {
                            const IconComp = ICON_LIB[tool.icon] || Globe;
                            return React.createElement("a", { key: tool.id, href: tool.url, target: "_blank", className: "group flex flex-col items-center p-5 bg-zinc-900/40 border border-zinc-800/50 rounded-2xl hover:bg-zinc-800 hover:border-zinc-700 transition-all hover:scale-105" },
                                React.createElement("div", { className: "w-14 h-14 rounded-2xl bg-gradient-to-br from-zinc-800 to-black flex items-center justify-center text-zinc-400 group-hover:text-white shadow-lg mb-3" }, React.createElement(IconComp, { size: 28 })),
                                React.createElement("span", { className: "text-sm font-medium text-zinc-300 group-hover:text-white text-center line-clamp-1" }, tool.name)
                            );
                        })
                    );
                } else {
                    // Group by categories
                    return React.createElement("div", { className: "space-y-10" },
                        categories.map(cat => {
                            const catTools = tools.filter(t => t.category === cat);
                            if (catTools.length === 0) return null;
                            return React.createElement("div", { key: cat, className: "space-y-4" },
                                React.createElement("h3", { className: "text-lg font-bold text-zinc-400 border-b border-zinc-800 pb-2 flex items-center gap-2" }, 
                                    React.createElement("span", { className: "w-2 h-2 rounded-full bg-indigo-500" }), cat
                                ),
                                React.createElement("div", { className: "grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-4" },
                                    catTools.map(tool => {
                                        const IconComp = ICON_LIB[tool.icon] || Globe;
                                        return React.createElement("a", { key: tool.id, href: tool.url, target: "_blank", className: "group flex flex-col items-center p-5 bg-zinc-900/40 border border-zinc-800/50 rounded-2xl hover:bg-zinc-800 hover:border-zinc-700 transition-all hover:scale-105" },
                                            React.createElement("div", { className: "w-14 h-14 rounded-2xl bg-gradient-to-br from-zinc-800 to-black flex items-center justify-center text-zinc-400 group-hover:text-white shadow-lg mb-3" }, React.createElement(IconComp, { size: 28 })),
                                            React.createElement("span", { className: "text-sm font-medium text-zinc-300 group-hover:text-white text-center line-clamp-1" }, tool.name)
                                        );
                                    })
                                )
                            );
                        })
                    );
                }
            };

            return React.createElement("div", { className: "flex h-full pb-20" },
                React.createElement("div", { className: "w-56 hidden md:flex flex-col border-r border-zinc-800 p-6 space-y-1 bg-zinc-950" }, 
                    React.createElement("h3", { className: "text-xs font-bold text-zinc-500 uppercase tracking-wider mb-6 px-2" }, "Library"), 
                    React.createElement("button", { onClick: () => setSelectedCategory("All"), className: `w-full text-left px-4 py-2.5 rounded-xl text-sm font-medium transition-all ${selectedCategory === "All" ? 'bg-indigo-600 text-white shadow-glow-sm' : 'text-zinc-400 hover:text-white hover:bg-zinc-900'}` }, "All Apps"), 
                    categories.map(cat => React.createElement("button", { key: cat, onClick: () => setSelectedCategory(cat), className: `w-full text-left px-4 py-2.5 rounded-xl text-sm font-medium transition-all ${selectedCategory === cat ? 'bg-zinc-800 text-white' : 'text-zinc-400 hover:text-white hover:bg-zinc-900'}` }, cat))
                ),
                React.createElement("div", { className: "flex-1 p-6 md:p-10 overflow-y-auto" },
                    React.createElement("div", { className: "flex justify-between items-center mb-8" }, 
                        React.createElement("div", null,
                            React.createElement("h2", { className: "text-3xl font-bold text-white" }, "Tools"),
                            React.createElement("p", { className: "text-zinc-400 text-sm mt-1" }, "Your digital workspace.")
                        ),
                        React.createElement("button", { onClick: () => setShowAddModal(true), className: "flex items-center gap-2 px-5 py-2.5 bg-indigo-600 hover:bg-indigo-500 text-white rounded-xl font-bold transition-all shadow-glow-sm hover:scale-105" }, React.createElement(Plus, { size: 18 }), "Add Tool")
                    ),
                    renderTools()
                ),
                showAddModal && React.createElement("div", { className: "fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm p-4" }, React.createElement("div", { className: "bg-zinc-900 border border-zinc-800 rounded-2xl w-full max-w-lg p-6 relative" }, React.createElement("button", { onClick: () => setShowAddModal(false), className: "absolute top-4 right-4 text-zinc-500 hover:text-white" }, React.createElement(X, { size: 20 })), React.createElement("h3", { className: "text-xl font-bold text-white mb-6" }, "Add New Tool"), React.createElement("div", { className: "space-y-4" }, React.createElement("input", { value: newTool.name, onChange: e => setNewTool({...newTool, name: e.target.value}), placeholder: "Tool Name", className: "w-full p-3 bg-black/50 border border-zinc-700 rounded-xl text-white focus:border-indigo-500 outline-none" }), React.createElement("input", { value: newTool.url, onChange: e => setNewTool({...newTool, url: e.target.value}), placeholder: "URL (https://...)", className: "w-full p-3 bg-black/50 border border-zinc-700 rounded-xl text-white focus:border-indigo-500 outline-none" }), React.createElement("div", null, React.createElement("label", { className: "text-xs text-zinc-500 mb-1 block" }, "Category"), isCustomCategory ? React.createElement("div", { className: "flex gap-2" }, React.createElement("input", { value: customCategoryName, onChange: e => setCustomCategoryName(e.target.value), placeholder: "New Category Name", className: "flex-1 p-3 bg-black/50 border border-zinc-700 rounded-xl text-white focus:border-indigo-500 outline-none" }), React.createElement("button", { onClick: () => setIsCustomCategory(false), className: "p-3 bg-zinc-800 text-zinc-400 rounded-xl hover:text-white" }, React.createElement(X, { size: 18 }))) : React.createElement("select", { value: newTool.category, onChange: e => { if(e.target.value === 'NEW') setIsCustomCategory(true); else setNewTool({...newTool, category: e.target.value}); }, className: "w-full p-3 bg-black/50 border border-zinc-700 rounded-xl text-white focus:border-indigo-500 outline-none" }, categories.map(c => React.createElement("option", { key: c, value: c }, c)), React.createElement("option", { value: "NEW", className: "text-indigo-400 font-bold" }, "+ Create New Category"))), React.createElement("div", null, React.createElement("label", { className: "text-xs text-zinc-500 mb-2 block" }, "Select Icon"), React.createElement("div", { className: "grid grid-cols-6 gap-2 max-h-32 overflow-y-auto p-2 bg-black/30 rounded-xl border border-zinc-800/50" }, Object.keys(ICON_LIB).map(iconName => { const I = ICON_LIB[iconName]; return React.createElement("button", { key: iconName, onClick: () => setNewTool({...newTool, icon: iconName}), className: `p-2 rounded-lg flex items-center justify-center transition-all ${newTool.icon === iconName ? 'bg-indigo-600 text-white' : 'text-zinc-500 hover:bg-zinc-800'}` }, React.createElement(I, { size: 18 })); }))), React.createElement("button", { onClick: handleAdd, className: "w-full py-3 bg-indigo-600 hover:bg-indigo-500 text-white font-bold rounded-xl mt-4" }, "Add Tool"))))
            );
        };

        // --- APP COMPONENT ---
        const App = () => {
            const tabConfig = {
                dashboard: { label: "Dashboard", icon: Layout },
                deadlines: { label: "Deadlines", icon: Hourglass },
                goals2026: { label: "2026 Plan", icon: Flag },
                tasks: { label: "Daily Tasks", icon: ListTodo },
                focus: { label: "Focus Mode", icon: Timer },
                braindump: { label: "Brain Dump", icon: FileText },
                spirituality: { label: "Spirituality", icon: Flower2 },
                food: { label: "Food Plan", icon: Utensils },
                fitness: { label: "Fitness", icon: Dumbbell },
                tools: { label: "Tools", icon: Wrench },
                wishlist: { label: "Wishlist", icon: Gift },
                library: { label: "Library", icon: Library }
            };

            const VALID_TABS = Object.keys(tabConfig);
            const [activeTab, setActiveTab] = useState("dashboard");
            const [user, setUser] = useState(null);
            
            // App Data
            const [deadlines, setDeadlines] = useState([]);
            const [tasks, setTasks] = useState([]);
            const [dumps, setDumps] = useState([]);
            const [meals, setMeals] = useState(DEFAULT_MEALS);
            const [goalsData, setGoalsData] = useState(DEFAULT_GOALS_DATA);
            const [dashboardData, setDashboardData] = useState({});
            const [spiritualNotes, setSpiritualNotes] = useState([]);
            
            // New Features Data
            const [tools, setTools] = useState(DEFAULT_TOOLS);
            const [toolCategories, setToolCategories] = useState(DEFAULT_TOOLS_CATEGORIES);
            const [wishlist, setWishlist] = useState([]);
            const [books, setBooks] = useState([]);

            // Timer State
            const [activeSound, setActiveSound] = useState(null);
            const [isPlayingSound, setIsPlayingSound] = useState(false);
            const audioRef = useRef(new Audio());
            const [focusState, setFocusState] = useState({ timeLeft: 1500, isActive: false, initialTime: 1500, mode: 'FOCUS' });
            
            useEffect(() => {
                let interval = null;
                if (focusState.isActive && focusState.timeLeft > 0) {
                    interval = setInterval(() => { setFocusState(prev => ({ ...prev, timeLeft: prev.timeLeft - 1 })); }, 1000);
                } else if (focusState.timeLeft === 0) {
                    setFocusState(prev => ({ ...prev, isActive: false }));
                }
                return () => clearInterval(interval);
            }, [focusState.isActive, focusState.timeLeft]);

            const handleTimerToggle = () => setFocusState(prev => ({ ...prev, isActive: !prev.isActive }));
            const handleTimerReset = (newTime, newMode) => { const time = newTime || focusState.initialTime; setFocusState({ timeLeft: time, isActive: false, initialTime: time, mode: newMode || 'FOCUS' }); };

            const toggleSound = async (sound) => {
                try {
                    if (activeSound === sound.id && isPlayingSound) { 
                        audioRef.current.pause(); 
                        setIsPlayingSound(false); 
                    } else { 
                        // Stop current sound if playing
                        if (isPlayingSound) {
                            audioRef.current.pause();
                        }
                        
                        audioRef.current.src = sound.url; 
                        audioRef.current.loop = true; 
                        await audioRef.current.play(); 
                        setIsPlayingSound(true); 
                        setActiveSound(sound.id); 
                    }
                } catch (err) {
                    console.error("Audio playback error:", err);
                    setIsPlayingSound(false);
                    // Fallback or silent failure to prevent app crash
                }
            };

            // DB Connectivity Check
            const [connectionError, setConnectionError] = useState(null);
            useEffect(() => {
                if(isSupabaseConfigured) {
                    supabase.from('tasks').select('count', { count: 'exact', head: true }).then(({ error }) => { if(error) setConnectionError("Cloud DB unreachable."); });
                }
            }, []);

            // Auth Check
            useEffect(() => {
                const sessionUser = JSON.parse(localStorage.getItem('lifeos_user_session'));
                if (sessionUser) setUser(sessionUser);
            }, []);

            // Data Sync
            useEffect(() => {
                if (!user) return;
                
                try {
                    const prefix = `lifeos_data_${user.id}_`;
                    setDeadlines(JSON.parse(localStorage.getItem(`${prefix}deadlines`) || '[]'));
                    setTasks(JSON.parse(localStorage.getItem(`${prefix}tasks`) || '[]'));
                    setDumps(JSON.parse(localStorage.getItem(`${prefix}dumps`) || '[]'));
                    setMeals(JSON.parse(localStorage.getItem(`${prefix}meals`) || JSON.stringify(DEFAULT_MEALS)));
                    setGoalsData(JSON.parse(localStorage.getItem(`${prefix}goals_2026`) || JSON.stringify(DEFAULT_GOALS_DATA)));
                    setSpiritualNotes(JSON.parse(localStorage.getItem(`${prefix}spiritual_notes`) || '[]'));
                    
                    // New Features Load
                    setTools(JSON.parse(localStorage.getItem(`${prefix}tools`) || JSON.stringify(DEFAULT_TOOLS)));
                    setToolCategories(JSON.parse(localStorage.getItem(`${prefix}tool_categories`) || JSON.stringify(DEFAULT_TOOLS_CATEGORIES)));
                    setWishlist(JSON.parse(localStorage.getItem(`${prefix}wishlist`) || '[]'));
                    setBooks(JSON.parse(localStorage.getItem(`${prefix}books`) || '[]'));
                    setDashboardData(JSON.parse(localStorage.getItem(`${prefix}dashboard`) || '{}'));

                } catch(e) {}
            }, [user]);

            // Save Local
            useEffect(() => {
                if(user) {
                    const prefix = `lifeos_data_${user.id}_`;
                    localStorage.setItem(`${prefix}deadlines`, JSON.stringify(deadlines));
                    localStorage.setItem(`${prefix}tasks`, JSON.stringify(tasks));
                    localStorage.setItem(`${prefix}dumps`, JSON.stringify(dumps));
                    localStorage.setItem(`${prefix}meals`, JSON.stringify(meals));
                    localStorage.setItem(`${prefix}goals_2026`, JSON.stringify(goalsData));
                    localStorage.setItem(`${prefix}spiritual_notes`, JSON.stringify(spiritualNotes));
                    localStorage.setItem(`${prefix}dashboard`, JSON.stringify(dashboardData));
                    
                    // New Features Save
                    localStorage.setItem(`${prefix}tools`, JSON.stringify(tools));
                    localStorage.setItem(`${prefix}tool_categories`, JSON.stringify(toolCategories));
                    localStorage.setItem(`${prefix}wishlist`, JSON.stringify(wishlist));
                    localStorage.setItem(`${prefix}books`, JSON.stringify(books));
                }
            }, [deadlines, tasks, dumps, meals, goalsData, spiritualNotes, dashboardData, tools, toolCategories, wishlist, books, user]);

            const handleLoginSuccess = (u) => { setUser(u); localStorage.setItem('lifeos_user_session', JSON.stringify(u)); };
            const handleLogout = () => { localStorage.removeItem('lifeos_user_session'); setUser(null); };

            // Handlers
            const handleAddDeadline = (item) => setDeadlines(prev => [...prev, { ...item, id: Date.now().toString() }]);
            const handleDeleteDeadline = (id) => setDeadlines(prev => prev.filter(i => i.id !== id));
            const handleAddTask = (item) => setTasks(prev => [...prev, { ...item, id: Date.now().toString() }]);
            const handleDeleteTask = (id) => setTasks(prev => prev.filter(t => t.id !== id));
            const handleUpdateTask = (id, updates) => setTasks(prev => prev.map(t => t.id === id ? { ...t, ...updates } : t));
            const handleAddDump = (text) => setDumps(prev => [...prev, { text, id: Date.now().toString() }]);
            const handleDeleteDump = (id) => setDumps(prev => prev.filter(d => d.id !== id));
            
            // New Feature Handlers
            const handleAddTool = (tool) => setTools(prev => [...prev, { ...tool, id: Date.now().toString() }]);
            const handleAddCategory = (cat) => setToolCategories(prev => [...prev, cat]);
            const handleAddWish = (item) => setWishlist(prev => [...prev, { ...item, id: Date.now().toString() }]);
            const handleDeleteWish = (id) => setWishlist(prev => prev.filter(i => i.id !== id));
            const handleAddBook = (book) => setBooks(prev => [...prev, { ...book, id: Date.now().toString() }]);
            const handleDeleteBook = (id) => setBooks(prev => prev.filter(b => b.id !== id));

            const handleAddSpiritualNote = (text) => setSpiritualNotes(prev => [...prev, { text, id: Date.now().toString() }]);
            const handleDeleteSpiritualNote = (id) => setSpiritualNotes(prev => prev.filter(n => n.id !== id));
            const handleUpdateMeal = (day, type, text) => setMeals(prev => {
                const exists = prev.find(m => m.day === day && m.type === type);
                if(exists) return prev.map(m => m.day === day && m.type === type ? { ...m, text } : m);
                return [...prev, { day, type, text }];
            });

            if (!user) return React.createElement(LandingPage, { onLoginSuccess: handleLoginSuccess, onGuestLogin: handleLoginSuccess });

            return React.createElement("div", { className: "min-h-screen bg-zinc-50 dark:bg-zinc-950 text-zinc-900 dark:text-zinc-100 font-sans" },
                React.createElement("aside", { className: "fixed left-0 top-0 h-full w-64 border-r border-zinc-200 dark:border-zinc-800 bg-white dark:bg-zinc-950 p-6 hidden md:flex flex-col z-20" },
                    React.createElement("h1", { className: "text-2xl font-bold mb-8" }, "LifeOS"),
                    React.createElement("nav", { className: "space-y-2 flex-1 overflow-y-auto no-scrollbar" },
                        VALID_TABS.map(t => React.createElement(NavItem, { key: t, icon: tabConfig[t].icon, label: tabConfig[t].label, active: activeTab === t, onClick: () => setActiveTab(t) }))
                    ),
                    React.createElement("div", { className: "pt-6 border-t border-zinc-200 dark:border-zinc-800 space-y-2" },
                        React.createElement("button", { onClick: handleLogout, className: "w-full flex items-center gap-3 px-4 py-3 rounded-xl text-red-500 hover:bg-red-50" }, React.createElement(LogOut, { size: 20 }), "Sign Out")
                    )
                ),
                React.createElement(MobileTopBar, { handleLogout, user }),
                React.createElement(MobileNavBar, { activeTab, setActiveTab, tabConfig }),
                React.createElement("main", { className: "md:ml-64 p-4 md:p-12 pb-24 pt-20 md:pt-12 max-w-7xl mx-auto" },
                    activeTab === 'dashboard' && React.createElement(DashboardView, { 
                        onNavigate: setActiveTab, tasks, deadlines, dashboardData, onUpdateDashboard: setDashboardData,
                        timerState: focusState, toggleTimer: handleTimerToggle, resetTimer: handleTimerReset
                    }),
                    activeTab === 'deadlines' && React.createElement(DeadlinesView, { deadlines, onAddDeadline: handleAddDeadline, onDeleteDeadline: handleDeleteDeadline }),
                    activeTab === 'tasks' && React.createElement(TasksView, { tasks, onAddTask: handleAddTask, onDeleteTask: handleDeleteTask, onUpdateTask: handleUpdateTask }),
                    activeTab === 'goals2026' && React.createElement(Goals2026View, { goalsData, onUpdateGoals: setGoalsData }),
                    activeTab === 'focus' && React.createElement(FocusView, { activeSound, isPlayingSound, toggleSound, timerState: focusState, toggleTimer: handleTimerToggle, resetTimer: handleTimerReset }),
                    activeTab === 'braindump' && React.createElement(BrainDumpView, { dumps, onAddDump: handleAddDump, onDeleteDump: handleDeleteDump }),
                    activeTab === 'spirituality' && React.createElement(SpiritualityView, { notes: spiritualNotes, onAddNote: handleAddSpiritualNote, onDeleteNote: handleDeleteSpiritualNote }),
                    activeTab === 'fitness' && React.createElement(FitnessView, {}),
                    activeTab === 'food' && React.createElement(FoodView, { meals, onUpdateMeal: handleUpdateMeal }),
                    // New Tabs
                    activeTab === 'tools' && React.createElement(ToolsView, { tools, categories: toolCategories, onAddTool: handleAddTool, onAddCategory: handleAddCategory }),
                    activeTab === 'wishlist' && React.createElement(WishlistView, { wishlist, onAddItem: handleAddWish, onDeleteItem: handleDeleteWish }),
                    activeTab === 'library' && React.createElement(LibraryView, { books, onAddBook: handleAddBook, onDeleteBook: handleDeleteBook })
                )
            );
        };

        const root = createRoot(document.getElementById('root'));
        root.render(React.createElement(App));
    </script>
</body>
</html>
